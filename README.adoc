:toc:

= tsugou-kun-react

[%hardbreaks]
調整さん （https://chouseisan.com/ ）のパクりサービス。リスペクト！


== ■動作手順
[%hardbreaks]
開発工程用サーバ起動手順を示す。
本プロジェクトでは、バックエンド用・フロントエンド用サーバを分けて開発している。
（2020/09/26現在、一緒にビルドする方法が分からないのと、効率が良さそうだと感じたため）

下記にバックエンドサーバ、フロントエンドサーバの順に動作手順を示す。

1. clone
1. バックエンドサーバセットアップのため、下記コマンドを実行する。
+
```shell
$ PJ_HOME=`pwd`/tsugou-kun-react
$ cd ${PJ_HOME}/backend
$ npm ci
$ cd ${PJ_HOME}/backend/src/db
$ ${PJ_HOME}/backend/node_modules/sequelize-cli/lib/sequelize db:migrate --env development
$ mv ${PJ_HOME}/backend/src/db/data/tsugoukun_development.sqlite3 ${PJ_HOME}/backend/data/
$ cd ${PJ_HOME}/backend
$ npm start
```
1. フロントエンドサーバセットアップのため、下記コマンドを実行する。
+
```shell
$ cd ${PJ_HOME}/frontend
$ npm ci
$ npm start
```


== ■開発者用メモ

=== ▼開発環境構築

==== ◎バックエンド側

プロジェクトフォルダ・TypeScript・Expressの準備を行う。

```shell
$ mkdir backend; cd backend
$ npm init
$ npm i -D \
    typescript \
    ts-node \
    ts-node-dev \
    sequelize-cli \
    tslint \
    @types/node \
    @types/express \
    @types/sqlite3
$ npm i \
    express \
    sqlite3 \
    sequelize \
    base64url \
    mocha \
    @types/mocha
$ tsc --version
$ tsc --init
```

===== ○DBマイグレーション・モデル初期構築

```shell
$ mkdir src/db
$ cd src/db
$ ../../node_modules/sequelize-cli/lib/sequelize init
$ ls
config/  migrations/  models/  seeders/
＜この間で config/config.json の接続先等を編集＞
$ ../../node_modules/sequelize-cli/lib/sequelize model:create \
    --name moyooshi \
    --underscored \
    --attributes \
        "name:string \
        ,memo:string \
        ,schedule_update_id:string"
$ ../../node_modules/sequelize-cli/lib/sequelize model:create \
    --name moyooshikouho_nichiji \
    --underscored \
    --attributes \
        "kouho_nichiji:string \
        ,moyooshi_id:bigint \
        ,schedule_update_id:string"
$ ../../node_modules/sequelize-cli/lib/sequelize model:create \
    --name sankasha \
    --underscored \
    --attributes \
        "name:string \
        ,moyooshi_id:bigint \
        ,comment:string"
$ ../../node_modules/sequelize-cli/lib/sequelize model:create \
    --name sanka_nichiji \
    --underscored \
    --attributes \
        "sanka_kahi:enum \
        ,event_kouho_nichiji_id:bigint \
        ,sankasha_id:bigint"
＜ここで、migration/とmodels/配下のソースに、非null制約・外部キー関連の設定（キーワード：associate, references）を行う＞
$ ../../node_modules/sequelize-cli/lib/sequelize db:migrate --env development
＜ここで、src/db/data配下に出力される.sqlite3ファイルを、data/に移動する＞

```


==== ◎フロントエンド側


===== ○実行コマンド
プロジェクトフォルダ・TypeScript・Webpack・ReactJSの準備を行う。

```shell
$ mkdir frontend; cd frontend
$ npm init
$ npm i -D typescript ts-loader tslint @types/react @types/react-dom @types/react-redux @types/react-router-dom webpack webpack-cli webpack-dev-server clean-webpack-plugin html-webpack-plugin style-loader css-loader
$ npm i react react-dom redux react-redux redux-saga @reduxjs/toolkit axios react-router@next react-router-dom@next history redux-actions react-bootstrap bootstrap react-modern-calendar-datepicker react-helmet
$ tsc --version
$ tsc --init
※React Routerについてはβ版の6を使用。競合のReach Routerとの合併版であり、便利かつ直感的であるため。正式版がリリースされ次第「@next」を除去する。
```

※ts-node：コンパイルした後にnodeで実行してくれるモジュール。 +
　package.jsonのscriptsに `ts-node` を実行するコマンドを定義する。

===== ○フォルダ構成
[%hardbreaks]
https://qiita.com/tashxii/items/0515f00ec641d52f879b[React+Redux+APIサーバーでのアプリケーションのディレクトリ/ファイル構成]
この記事での考え方が一番しっくり来たため採用。



=== ▼参照資料

* https://qiita.com/pochopocho13/items/79a4735031ce11a91df7[Node+TypeScript+ExpressでAPIサーバ構築]
* https://ics.media/entry/16329/[最新版TypeScript+webpack 4の環境構築まとめ(React, Vue.js, Three.jsのサンプル付き)]
* https://qiita.com/niyou0ct/items/cc09ed42a6a51cf2a8b1[ReactでAPI処理はredux-sagaを使うのがオススメ！]
* https://qiita.com/pullphone/items/fdb0f36d8b4e5c0ae893[ざっくり React & Redux with TypeScript]
* https://qiita.com/kuy/items/716affc808ebb3e1e8ac[★redux-sagaで非同期処理と戦う]
* https://www.hypertextcandy.com/react-error-handling[Reactアプリにおける非同期通信エラー処理の実装案]
* https://blog.capilano-fw.com/?p=5582[保存版！「sequelize」モデルの使い方実例・全59件]